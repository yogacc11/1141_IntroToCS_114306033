<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HW7 1A2B Game</title>
</head>
<body>

    <h1>114306033_HW7_1A2B</h1>

    <p>請輸入 4 個不重複的數字：</p>
    
    <input type="text" id="guessInput" placeholder="Ex: 1234" maxlength="4">
    <button onclick="play()">Guess!</button>

    <div id="record-area">
        <strong>Game Record:</strong>
        <div id="records"></div>
    </div>

    <script>
        var secretCode = "";
        var attempts = 0;
        secretCode = generateAnswer();

        function generateAnswer() {
            var nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
            var ans = "";
            for (var i = 0; i < 4; i++) {
                var index = Math.floor(Math.random() * nums.length);
                ans += nums[index];
                nums.splice(index, 1); 
            }
            return ans;
        }

        function isValid(str) {
            if (str.length !== 4) return false;

            if (isNaN(str)) return false;

            var uniqueSet = new Set(str);
            if (uniqueSet.size !== 4) return false;

            return true;
        }

        function checkAB(guess, ans) {
            var countA = 0;
            var countB = 0;

            for (var i = 0; i < 4; i++) {
                var currentDigit = guess[i];
                
                if (currentDigit === ans[i]) {
                    countA++;
                } else if (ans.includes(currentDigit)) {
                    countB++;
                }
            }
            return countA + "A" + countB + "B";
        }

        function play() {
            var inputField = document.getElementById("guessInput");
            var guess = inputField.value.trim();

            if (!isValid(guess)) {
                alert("輸入錯誤！請輸入 4 個「不重複」的數字。");
                inputField.value = "";
                return;
            }
            attempts++;
            var result = checkAB(guess, secretCode);
            var recordDiv = document.getElementById("records");
            var newRecord = document.createElement("div");
            newRecord.className = "record-item";
            newRecord.innerText = "第" + attempts + "次: " + guess + " - " + result;
            recordDiv.appendChild(newRecord);

            if (result === "4A0B") {
                alert("恭喜答對！正確答案是 " + secretCode + "。\n你總共猜了 " + attempts + " 次。");
            }

            inputField.value = "";
            inputField.focus();
        }
    </script>
</body>
</html>